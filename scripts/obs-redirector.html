<!DOCTYPE html>
<html>
<head>
    <title>Fazzk OBS ìë™ ì—°ê²°</title>
    <meta charset="UTF-8">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white; 
            margin: 0; 
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            text-align: center;
            max-width: 500px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status { 
            font-size: 18px;
            margin-bottom: 20px;
        }
        .loading { 
            color: #00ff88; 
            animation: pulse 2s infinite;
        }
        .error { 
            color: #ff4444; 
        }
        .success { 
            color: #00ff88; 
        }
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            width: 0%;
            transition: width 0.3s ease;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .port-list {
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
        }
        .current-port {
            color: #00ff88;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ® Fazzk OBS ì—°ê²°</h2>
        <div class="status loading" id="status">ğŸ” Fazzk ì„œë²„ ê²€ìƒ‰ ì¤‘...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
        <div class="port-list" id="portInfo"></div>
    </div>
    
    <script>
    let currentPortIndex = 0;
    const ports = [3001, 3000, 3002, 3003, 3004, 3005, 8080, 8081];
    
    async function findFazzkServer() {
        const status = document.getElementById('status');
        const progress = document.getElementById('progress');
        const portInfo = document.getElementById('portInfo');
        
        status.className = 'status loading';
        status.textContent = 'ğŸ” Fazzk ì„œë²„ ê²€ìƒ‰ ì¤‘...';
        
        for (let i = 0; i < ports.length; i++) {
            const port = ports[i];
            currentPortIndex = i;
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progressPercent = ((i + 1) / ports.length) * 100;
            progress.style.width = progressPercent + '%';
            
            status.textContent = `ğŸ” í¬íŠ¸ ${port} í™•ì¸ ì¤‘... (${i+1}/${ports.length})`;
            portInfo.innerHTML = `ê²€ìƒ‰ ì¤‘ì¸ í¬íŠ¸: <span class="current-port">${port}</span>`;
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 1500);
                
                const response = await fetch(`http://localhost:${port}/settings`, {
                    method: 'GET',
                    mode: 'cors',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    // JSON ì‘ë‹µì¸ì§€ í™•ì¸
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        redirectToFazzk(port);
                        return;
                    }
                }
            } catch (e) {
                // í¬íŠ¸ ì‚¬ìš© ë¶ˆê°€ ë˜ëŠ” íƒ€ì„ì•„ì›ƒ - ë‹¤ìŒ í¬íŠ¸ ì‹œë„
                continue;
            }
            
            // ê° í¬íŠ¸ ê²€ì‚¬ ì‚¬ì´ì— ì§§ì€ ì§€ì—°
            await new Promise(resolve => setTimeout(resolve, 200));
        }
        
        // ëª¨ë“  ë°©ë²• ì‹¤íŒ¨
        progress.style.width = '100%';
        status.className = 'status error';
        status.innerHTML = `
            âŒ Fazzk ì„œë²„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br><br>
            <strong>í•´ê²° ë°©ë²•:</strong><br>
            1. Fazzk ì•±ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸<br>
            2. ë°©í™”ë²½ì´ ì°¨ë‹¨í•˜ê³  ìˆëŠ”ì§€ í™•ì¸<br>
            3. ìˆ˜ë™ìœ¼ë¡œ http://localhost:3001/follower ì‹œë„<br><br>
            <small>10ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ê²€ìƒ‰í•©ë‹ˆë‹¤...</small>
        `;
        
        portInfo.textContent = 'ê²€ìƒ‰ëœ í¬íŠ¸: ì—†ìŒ';
        
        // 10ì´ˆ í›„ ì¬ì‹œë„
        setTimeout(() => {
            progress.style.width = '0%';
            findFazzkServer();
        }, 10000);
    }
    
    function redirectToFazzk(port) {
        const status = document.getElementById('status');
        const portInfo = document.getElementById('portInfo');
        const progress = document.getElementById('progress');
        
        progress.style.width = '100%';
        status.className = 'status success';
        status.innerHTML = `âœ… Fazzk ì„œë²„ ë°œê²¬!<br>í¬íŠ¸ ${port}ì—ì„œ ì—°ê²° ì¤‘...`;
        portInfo.innerHTML = `ë°œê²¬ëœ í¬íŠ¸: <span class="current-port">${port}</span>`;
        
        // 1.5ì´ˆ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸
        setTimeout(() => {
            window.location.href = `http://localhost:${port}/follower`;
        }, 1500);
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    findFazzkServer();
    
    // 30ì´ˆë§ˆë‹¤ ì¬ê²€ìƒ‰ (ì—°ê²° ì‹¤íŒ¨ ì‹œ ìë™ ë³µêµ¬)
    setInterval(() => {
        // í˜„ì¬ ê²€ìƒ‰ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì¬ê²€ìƒ‰
        const status = document.getElementById('status');
        if (status.className.includes('error')) {
            findFazzkServer();
        }
    }, 30000);
    </script>
</body>
</html>